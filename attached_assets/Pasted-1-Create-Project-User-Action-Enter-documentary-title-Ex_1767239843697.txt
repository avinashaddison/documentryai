1Ô∏è‚É£ Create Project

User Action

Enter documentary title
Example: ‚ÄúThe History of Ancient Rome‚Äù

System

Create project_id

Initialize folders

Set state = CREATED

{
  "title": "The History of Ancient Rome",
  "state": "CREATED"
}

2Ô∏è‚É£ Research Phase (NEW ‚Äì MUST COME FIRST)
2.1 Research Query Expansion

LLM: Claude

Claude ONLY:

Expands research questions

Identifies timelines, eras, controversies

NO storytelling, NO chapters

Output:

research_queries.json

2.2 Deep Research Collection

APIs

Perplexity ‚Üí cited & fresh sources

Exa ‚Üí long-form semantic articles

Tavily ‚Üí full text extraction

Output:

sources.json

2.3 Research Analysis & Validation

LLM: Claude (analysis mode)

Claude generates:

Chronological factual timeline

Verified facts only

Conflicting viewpoints (if any)

research_summary.json


‚úÖ Gate Rule:
If research fails ‚Üí pipeline stops here.

Set state ‚Üí RESEARCH_DONE

3Ô∏è‚É£ Story & Chapter Generation

LLM: Claude

Now (and only now):

Generate documentary narrative

Chapter-wise script

Neutral, factual tone

Duration-aware writing

Output:

chapters/chapter_01.json
chapters/chapter_02.json


Set state ‚Üí SCRIPT_DONE

4Ô∏è‚É£ Image Prompt + Image Generation

Models (Selectable):

Flux 1.1 Pro

Ideogram

Flow:

Claude generates scene-wise image prompts

Image model generates cinematic visuals

8‚Äì15 images per chapter

Output:

images/chapter_01/scene_01.png


Set state ‚Üí IMAGES_DONE

5Ô∏è‚É£ Voiceover Generation

Voice API

Deepgram ‚Äì Mars Narrator

Rules:

Chapter-wise narration

Documentary pacing (130‚Äì150 WPM)

One audio file per chapter

Output:

audio/chapter_01.wav


Set state ‚Üí AUDIO_DONE

6Ô∏è‚É£ Editor ‚Äì Timeline Preview & Review

Editor Role (IMPORTANT FIX)

Read-only asset preview

Timeline view (scene + audio sync)

Allow:

Scene reorder

Duration adjust

Image replace

‚ö†Ô∏è Editor must NOT regenerate content

Data source:

timeline.json


Set state ‚Üí EDITOR_APPROVED

7Ô∏è‚É£ Export / Render

Renderer: FFmpeg

Features:

Ken Burns (pan + zoom)

Cross-fade transitions

Captions

Chapter markers

‚è±Ô∏è Performance:

~10‚Äì20 minutes render for 1-hour video

Output:

final/petr_documentary.mp4


Set state ‚Üí RENDERED

üîÅ STATE-BASED RESUME SYSTEM (MANDATORY)
CREATED
‚Üí RESEARCH_DONE
‚Üí SCRIPT_DONE
‚Üí IMAGES_DONE
‚Üí AUDIO_DONE
‚Üí EDITOR_APPROVED
‚Üí RENDERED
